@model List<MO.GauravProfile.ProfileVerificationPendingVM>
@{
    ViewData["Title"] = "Menu";
    Layout = "~/Views/Shared/_LayoutIn.cshtml";
}
@using MO.Common
@using Microsoft.AspNetCore.Http
@using System.Security.Claims
@inject IHttpContextAccessor HttpContextAccessor
@{
    var user = HttpContextAccessor.HttpContext.User;
    var isAuthenticated = user.Identity.IsAuthenticated;
    var district = user.FindFirst("DistrictName")?.Value;
    var name = user.FindFirst("UserName")?.Value;
    var role = user.FindFirst("RoleId")?.Value;
    var DepartmetId = user.FindFirst("DepartmentId")?.Value;
    var Departmet = user.FindFirst("Department")?.Value;
    var userlevel = user.FindFirst("UserLevel")?.Value;
    var nonce = Context.Items["CSPNonce"]?.ToString();
    //MenuPermissionMO p = ViewBag.Permission as MenuPermissionMO ?? new MenuPermissionMO();
}
<style nonce="@nonce">
    .q-row {
        background: #f0f0f0;
        font-weight: bold;
        border: 1px solid #000;
    }

        .q-row td {
            padding: 10px;
            width: 100%;
        }

    .a-row {
        border: 1px solid #000;
    }

        .a-row td {
            padding: 10px 10px 10px 30px;
        }

    .answer-box {
        white-space: pre-wrap;
        min-height: 60px;
        border: 1px solid #000;
        padding: 8px;
    }

    .subtable-row {
        border: 1px solid #000;
    }
</style>
<style nonce="@nonce">
    .t-row {
        display: flex;
        border: 1px solid #ccc;
        margin-bottom: 5px;
    }

    .t-cell {
        flex: 1;
        border-right: 1px solid #ccc;
        padding: 8px;
    }

        .t-cell:last-child {
            border-right: none;
        }

    .header-row {
        background: #e0e0e0;
        font-weight: bold;
    }
</style>
<div class="card radius-10">
    <div class="card-header color-header headercolor1">
        <div class="d-flex align-items-center justify-content-between w-100">
            <!-- Title -->
            <h6 class="mb-0">Pending Verification List</h6>
        </div>
    </div>
    <div class="card-body">
        <table class="table table-bordered mt-4">
            <thead>
                <tr>
                    <th>Sr.No</th>
                    <th>District</th>
                    <th>Gaurav</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    int sr = 1;
                    foreach (var item in Model)
                    {
                        <tr>
                            <td>@sr</td>
                            <td>@item.DistrictName</td>
                            <td>@item.GauravName</td>
                            <td>
                                <button class="btn btn-sm btn-info btn-view-profile"
                                        data-guid="@item.GauravGuid"
                                        data-district="@item.DistrictId">
                                    View Profile
                                </button>
                                @* <a class="btn btn-sm btn-primary"
                               //    asp-controller="Profile"
                               //    asp-action="ViewProfile"
                               //    asp-route-gauravGuid="@item.GauravGuid"
                               //    asp-route-district="@item.DistrictId">
                               //     View Profile
                               // </a> *@                              
                                    </td>
                        </tr>
                        sr++;
                    }
                }
                else
                {
                    <tr>
                        <td colspan="4" class="text-center text-danger">
                            No records found
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="profileModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title">Profile Details</h5>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close">
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body" id="profileModalContent">
                <!-- Partial view will load here -->
            </div>

        </div>
    </div>
</div>
@* <div class="modal fade" id="PerviousRemark" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title">All Remark</h5>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close">
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body" id="PerviousRemarkContent">
               
            </div>

        </div>
    </div>
</div> *@
<script nonce="@Context.Items["CSPNonce"]" src="~/custom/profileverification.js"></script>
<script nonce="@nonce">
    document.addEventListener("DOMContentLoaded", function () {

        document.querySelectorAll(".btn-view-profile").forEach(function (btn) {
            btn.addEventListener("click", function () {
                const guid = this.getAttribute("data-guid");
                const district = this.getAttribute("data-district");
                openProfile(guid, district);
            });

        });

        // document.querySelectorAll(".btn-view-previousremak").forEach(function (btn) {
        //     btn.addEventListener("click", function () {
        //         const guid = this.getAttribute("data-guid");
        //         const district = this.getAttribute("data-district");
        //         openTrail1(guid);
        //     });

        // });

    });

    function openProfile(gauravGuid, districtId) {
        $.ajax({
            url: '/Profile/ViewProfile',
            type: 'GET',
            data: {
                gauravGuid: gauravGuid,
                district: districtId
            },
            success: function (response) {
                $('#profileModalContent').html(response);
                //$('#profileModal').modal('show');

               const modalEl = document.getElementById('profileModal');

            const modal = new bootstrap.Modal(modalEl, {
                backdrop: false,   // ✅ backdrop remove
                keyboard: true
            });

            modal.show();
            },
            error: function () {
                alert('Failed to load profile');
            }
        });
    }

    // function openTrail1(gauravGuid) {
    //     $.ajax({
    //         url: '/Profile/ViewTrail',
    //         type: 'GET',
    //         data: {
    //             gauravGuid: gauravGuid,
              
    //         },
    //         success: function (response) {
    //             $('#PerviousRemarkContent').html(response);
    //             //$('#profileModal').modal('show');

    //            const modalEl = document.getElementById('PerviousRemark');

    //         const modal = new bootstrap.Modal(modalEl, {
    //             backdrop: false,   // ✅ backdrop remove
    //             keyboard: true
    //         });

    //         modal.show();
    //         },
    //         error: function () {
    //             alert('Failed to load profile');
    //         }
    //     });
    // }
</script>


